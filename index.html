<!DOCTYPE html>
<html>
<head>
    <title>Live Stream Player</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <!-- Plyr CSS -->
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
        }
        #player-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #player {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        /* Custom Watermark */
        .watermark {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10;
            opacity: 0.7;
            max-width: 120px;
            max-height: 50px;
            transition: opacity 0.3s;
        }
        .watermark:hover {
            opacity: 1;
        }
        /* Landscape optimization */
        @media (orientation: landscape) {
            #player {
                max-height: 100vh;
            }
            .watermark {
                max-width: 150px;
            }
        }
        /* Hide native branding */
        video::-webkit-media-controls-overlay-play-button,
        video::-webkit-media-text-track-container {
            display: none !important;
        }
    </style>
</head>
<body>
    <div id="player-container">
        <video id="player" playsinline controls autoplay></video>
        <!-- Custom Watermark Image -->
        <img src="https://via.placeholder.com/150x50/000000/FFFFFF?text=Your+Logo" class="watermark" alt="Watermark">
    </div>

    <!-- Plyr + HLS.js -->
    <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        // Remove native branding (Tata Play)
        const video = document.getElementById('player');
        video.addEventListener('loadedmetadata', function() {
            const tracks = video.textTracks;
            for (let i = 0; i < tracks.length; i++) {
                tracks[i].mode = 'hidden';
            }
        });

        // Setup HLS
        const streamUrl = "https://starsporthindii.pages.dev/index.m3u8";
        
        if (Hls.isSupported()) {
            const hls = new Hls({
                enableCEA708Captions: false, // Disable closed captions
                renderTextTracks: false       // Hide text tracks
            });
            hls.loadSource(streamUrl);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, function() {
                video.play();
            });
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = streamUrl;
            video.addEventListener('loadedmetadata', function() {
                video.play();
            });
        }

        // Initialize Plyr player
        const player = new Plyr('#player', {
            controls: [
                'play-large',
                'play',
                'progress',
                'current-time',
                'mute',
                'volume',
                'settings',
                'pip',
                'airplay',
                'fullscreen'
            ],
            ratio: '16:9',
            autoplay: true,
            hideControls: true, // Start with hidden controls
            seekTime: 10,
            storage: { enabled: false },
            listeners: {
                hidden: () => document.querySelector('.plyr__controls').style.opacity = '0',
                shown: () => document.querySelector('.plyr__controls').style.opacity = '1'
            }
        });

        // Auto-hide controls after 3 seconds
        let controlsTimeout;
        function hideControls() {
            if (player.playing) {
                player.toggleControls(false);
            }
        }
        
        function resetControlsTimer() {
            clearTimeout(controlsTimeout);
            player.toggleControls(true);
            controlsTimeout = setTimeout(hideControls, 3000);
        }

        // Event listeners
        player.on('ready', function() {
            resetControlsTimer();
            attemptFullscreen();
        });
        
        player.on('play', resetControlsTimer);
        player.on('controlsshown', resetControlsTimer);
        player.on('controlshidden', () => clearTimeout(controlsTimeout));
        
        video.addEventListener('mousemove', resetControlsTimer);
        video.addEventListener('touchstart', resetControlsTimer);

        // Fullscreen handling
        function attemptFullscreen() {
            if (player.fullscreen.active) return;
            try {
                player.fullscreen.enter();
            } catch(e) {
                console.log("Fullscreen error:", e);
            }
        }
        
        window.addEventListener('orientationchange', function() {
            setTimeout(attemptFullscreen, 300);
        });
    </script>
</body>
</html>
